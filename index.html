<!DOCTYPE html>
<html>
<head>
  <title>Restaurant Order List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial; padding: 20px;
      background-color: white; color: black;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark {
      background-color: #1e1e1e;
      color: white;
    }
    h2 { text-align: center; }
    .item {
      display: flex; align-items: center; gap: 5px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    input[type="text"], input[type="number"], select {
      padding: 8px; font-size: 16px;
    }
    input[type="text"] { flex: 2; }
    input[type="number"] { width: 80px; }
    select { width: 90px; }
    input[type="checkbox"] { transform: scale(1.4); }
    button {
      padding: 10px; font-size: 14px;
      cursor: pointer; margin-top: 5px;
      width: 100%;
    }
    .action-btns { display: flex; gap: 5px; }
  </style>
</head>
<body>
  <h2>Restaurant Order List</h2>

  <div id="list"></div>

  <input type="text" id="newItem" placeholder="New Item Name">
  <button onclick="addItem()">Add Item</button>
  <button onclick="prepareThen(sortItems)">Sort A–Z</button>
  <button onclick="prepareThen(resetList)">Reset List</button>
  <button onclick="prepareThen(exportToPDF)">Export to PDF</button>
  <button onclick="toggleDarkMode()">Toggle Dark Mode</button>

  <script>
    let defaultItems = [
      { name: "Cherry Tomato", qty: "", unit: "pcs", done: false },
      { name: "Cucumber", qty: "", unit: "pcs", done: false },
      { name: "Tomato", qty: "", unit: "pcs", done: false },
      { name: "Baby Spinach", qty: "", unit: "pcs", done: false },
      { name: "Lemon", qty: "", unit: "pcs", done: false },
      { name: "Lime", qty: "", unit: "pcs", done: false },
      { name: "Romaine Hearts", qty: "", unit: "pcs", done: false },
      { name: "Green Bell Pepper", qty: "", unit: "pcs", done: false },
      { name: "Sliced Mushroom", qty: "", unit: "pcs", done: false },
      { name: "Red Bell Pepper", qty: "", unit: "pcs", done: false }
    ];

    let items = JSON.parse(localStorage.getItem('orderList')) || JSON.parse(JSON.stringify(defaultItems));

    function saveItems() {
      localStorage.setItem('orderList', JSON.stringify(items));
    }

    function syncInputValues() {
      const itemDivs = document.querySelectorAll('.item');
      itemDivs.forEach((div, index) => {
        const checkbox = div.querySelector('input[type="checkbox"]');
        const name = div.querySelector('input[type="text"]').value.trim();
        const qty = div.querySelector('input[type="number"]').value;
        const unit = div.querySelector('select').value;
        items[index].name = name;
        items[index].qty = qty;
        items[index].unit = unit;
        items[index].done = checkbox.checked;
      });
      saveItems();
    }

    function prepareThen(actionFunc) {
      syncInputValues();
      actionFunc();
    }

    function renderList() {
      let listDiv = document.getElementById('list');
      listDiv.innerHTML = '';
      items.forEach((item, index) => {
        listDiv.innerHTML += `
          <div class="item">
            <input type="checkbox" ${item.done ? "checked" : ""} onchange="toggleDone(${index})">
            <input type="text" value="${item.name}" onchange="updateName(${index}, this.value)">
            <input type="number" value="${item.qty}" placeholder="Qty" onchange="updateQty(${index}, this.value)">
            <select onchange="updateUnit(${index}, this.value)">
              <option value="pcs" ${item.unit === "pcs" ? "selected" : ""}>pcs</option>
              <option value="case" ${item.unit === "case" ? "selected" : ""}>case</option>
              <option value="box" ${item.unit === "box" ? "selected" : ""}>box</option>
              <option value="g" ${item.unit === "g" ? "selected" : ""}>g</option>
            </select>
            <div class="action-btns">
              <button onclick="deleteItem(${index})">❌</button>
            </div>
          </div>`;
      });
    }

    function toggleDone(index) {
      items[index].done = !items[index].done;
      saveItems();
    }

    function addItem() {
      let newItem = document.getElementById('newItem').value;
      if (newItem.trim() !== '') {
        items.push({ name: newItem.trim(), qty: "", unit: "pcs", done: false });
        document.getElementById('newItem').value = '';
        saveItems();
        renderList();
      }
    }

    function updateQty(index, value) {
      items[index].qty = value;
      saveItems();
    }

    function updateUnit(index, value) {
      items[index].unit = value;
      saveItems();
    }

    function updateName(index, value) {
      items[index].name = value.trim();
      saveItems();
    }

    function deleteItem(index) {
      if (confirm("Delete this item?")) {
        items.splice(index, 1);
        saveItems();
        renderList();
      }
    }

    function sortItems() {
      items.sort((a, b) => a.name.localeCompare(b.name));
      saveItems();
      renderList();
    }

    function resetList() {
      if (confirm("Are you sure you want to reset the list?")) {
        items = JSON.parse(JSON.stringify(defaultItems));
        saveItems();
        renderList();
      }
    }

    async function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const today = new Date().toLocaleString();
      doc.setFontSize(14);
      doc.text("Restaurant Order List", 20, 20);
      doc.setFontSize(10);
      doc.text(`Exported on: ${today}`, 20, 26);
      let y = 40;
      items.forEach(item => {
        const line = `${item.done ? "[x]" : "[ ]"} ${item.name}: ${item.qty || ""} ${item.unit}`;
        doc.text(line, 20, y);
        y += 10;
      });
      doc.save("Restaurant_Order_List.pdf");
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark");
    }

    renderList();
  </script>
</body>
</html>
