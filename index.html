<!DOCTYPE html>
<html>
<head>
  <title>Produce Order</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body.dark { background-color: #1e1e1e; color: white; }
    .item { margin-bottom: 15px; }
    .item-number { font-weight: bold; margin-right: 10px; width: 30px; display: inline-block; }
    .form-select, .form-control { max-width: 120px; }
  </style>
</head>
<body class="bg-light p-3">
  <div class="container bg-white shadow rounded p-4">
    <h2 class="text-center mb-4 text-primary">Produce Order</h2>

    <div id="list"></div>

    <div class="input-group mb-3">
      <input type="text" class="form-control" id="newItem" placeholder="New Item Name">
      <button class="btn btn-primary" onclick="addItem()">Add Item</button>
    </div>

    <div class="d-grid gap-2 mb-2">
      <button class="btn btn-secondary" onclick="prepareThen(sortItems)">Sort Aâ€“Z</button>
      <button class="btn btn-warning" onclick="prepareThen(resetList)">Reset List</button>
      <button class="btn btn-success" onclick="prepareThen(exportToPDF)">Export to PDF</button>
      <button class="btn btn-dark" onclick="toggleDarkMode()">Toggle Dark Mode</button>
    </div>
  </div>

  <script>
    let defaultItems = [
      { name: "Cherry Tomato", qty: "", unit: "pcs" },
      { name: "Cucumber", qty: "", unit: "pcs" },
      { name: "Tomato", qty: "", unit: "pcs" },
      { name: "Baby Spinach", qty: "", unit: "pcs" },
      { name: "Lemon", qty: "", unit: "pcs" },
      { name: "Lime", qty: "", unit: "pcs" },
      { name: "Romaine Hearts", qty: "", unit: "pcs" },
      { name: "Green Bell Pepper", qty: "", unit: "pcs" },
      { name: "Sliced Mushroom", qty: "", unit: "pcs" },
      { name: "Red Bell Pepper", qty: "", unit: "pcs" }
    ];

    let items = JSON.parse(localStorage.getItem('orderList')) || JSON.parse(JSON.stringify(defaultItems));

    function saveItems() {
      localStorage.setItem('orderList', JSON.stringify(items));
    }

    function syncInputValues() {
      const itemDivs = document.querySelectorAll('.item');
      itemDivs.forEach((div, index) => {
        const name = div.querySelector('input[type="text"]').value.trim();
        const qty = div.querySelector('input[type="number"]').value;
        const unit = div.querySelector('select').value;
        items[index].name = name;
        items[index].qty = qty;
        items[index].unit = unit;
      });
      saveItems();
    }

    function prepareThen(actionFunc) {
      syncInputValues();
      actionFunc();
    }

    function renderList() {
      const listDiv = document.getElementById('list');
      listDiv.innerHTML = '';
      items.forEach((item, index) => {
        let number = index + 1;
        listDiv.innerHTML += `
          <div class="item row align-items-center gx-2">
            <div class="col-auto">
              <span class="item-number">${number}.</span>
            </div>
            <div class="col-6">
              <input type="text" class="form-control" value="${item.name}" onchange="updateName(${index}, this.value)">
            </div>
            <div class="col-2">
              <input type="number" class="form-control form-control-sm" value="${item.qty}" placeholder="Qty" onchange="updateQty(${index}, this.value)">
            </div>
            <div class="col-2">
              <select class="form-select form-select-sm" onchange="updateUnit(${index}, this.value)">
                <option value="pcs" ${item.unit === "pcs" ? "selected" : ""}>pcs</option>
                <option value="case" ${item.unit === "case" ? "selected" : ""}>case</option>
                <option value="box" ${item.unit === "box" ? "selected" : ""}>box</option>
                <option value="g" ${item.unit === "g" ? "selected" : ""}>g</option>
              </select>
            </div>
          </div>`;
      });
    }

    function addItem() {
      const newItem = document.getElementById('newItem').value;
      if (newItem.trim() !== '') {
        items.push({ name: newItem.trim(), qty: "", unit: "pcs" });
        document.getElementById('newItem').value = '';
        saveItems();
        renderList();
      }
    }

    function updateQty(index, value) {
      items[index].qty = value;
      saveItems();
    }

    function updateUnit(index, value) {
      items[index].unit = value;
      saveItems();
    }

    function updateName(index, value) {
      items[index].name = value.trim();
      saveItems();
    }

    function sortItems() {
      items.sort((a, b) => a.name.localeCompare(b.name));
      saveItems();
      renderList();
    }

    function resetList() {
      if (confirm("Are you sure you want to reset the list?")) {
        items = JSON.parse(JSON.stringify(defaultItems));
        saveItems();
        renderList();
      }
    }

    async function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const today = new Date().toLocaleString();
      doc.setFontSize(14);
      doc.text("Produce Order", 20, 20);
      doc.setFontSize(10);
      doc.text(`Exported on: ${today}`, 20, 26);
      let y = 40;
      items.forEach((item, index) => {
        const line = `${index + 1}. ${item.name}: ${item.qty || ""} ${item.unit}`;
        doc.text(line, 20, y);
        y += 10;
      });
      doc.save("Produce_Order_List.pdf");
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark");
    }

    renderList();
  </script>
</body>
</html>
